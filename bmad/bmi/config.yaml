# BMI Module Configuration
# Generated by BMAD BMI module creation
# Version: 1.0.0-alpha
# Date: 2025-11-15

# Module Metadata
module_code: bmi
module_name: "Infrastructure & DevOps"
module_version: "1.0.0-alpha.1"
module_description: "Complete deployment, release management, and infrastructure automation for BMAD projects"

# Inherit BMM settings
inherit_from: '{project-root}/bmad/bmm/config.yaml'

# Core Configuration Values (inherited from BMM, can override)
user_name: Chris
communication_language: English
document_output_language: English
output_folder: '{project-root}/docs'

# BMI-Specific Configuration

# Deployment Configuration
deployment:
  # Auto-deployment settings
  auto_deploy_on_merge: true                # Auto-deploy after story merge to main
  auto_deploy_environments:
    - dev                                    # Always deploy to dev
    - staging                                # Deploy to staging if dev succeeds

  # Platform configuration
  default_platform: "auto"                   # Auto-detect platform or specify: vercel, railway, render, aws, etc.

  # Platform-specific configurations (optional)
  platform_configs:
    vercel:
      # team_id: "team_xxx"                 # Vercel team ID (optional)
      # project_id: "prj_xxx"               # Vercel project ID (optional)
    railway:
      # project_id: "xxx"                   # Railway project ID (optional)
    aws:
      # region: "us-east-1"                 # AWS region (optional)

  # Validation settings
  run_smoke_tests: true                      # Run smoke tests after deployment
  run_performance_tests: false               # Run performance tests after deployment (optional)
  block_on_test_failure: true                # Block further deployment if tests fail

  # Deployment gates
  require_approval_for:
    - production                             # Always require manual approval for production

  # Database migration
  auto_run_migrations: true                  # Auto-run migrations during deployment
  migration_tool: "auto"                     # Auto-detect or specify: prisma, drizzle, knex, sequelize, typeorm
  backup_before_migration: true              # Backup database before migrations (production only)

  # Container configuration
  container_registry: "docker.io"            # docker.io, ghcr.io, ecr.aws, gcr.io
  container_namespace: ""                    # Container registry namespace (e.g., "myorg")
  multi_arch_build: false                    # Build for multiple architectures (ARM + x86)

  # Secrets management
  secrets_provider: "env"                    # env, vault, aws-secrets, gcp-secrets, azure-keyvault, doppler
  secrets_config: {}                         # Provider-specific configuration

# Release Configuration
release:
  # Release automation
  auto_release_on_epic_complete: false       # Manual release by default (set true for auto-release)

  # Versioning
  version_strategy: "semantic"               # semantic, calendar, custom
  version_file: "package.json"               # File containing version number

  # Changelog
  changelog_format: "keepachangelog"         # keepachangelog, conventional, angular
  changelog_file: "CHANGELOG.md"
  include_commit_links: true                 # Link to commits in changelog

  # Release notes
  release_notes_template: "{project-root}/bmad/bmi/templates/release-notes.md"

  # Production deployment
  deploy_to_production: false                # Require manual trigger for production deploy
  run_load_tests: true                       # Run load tests before production deployment

  # DORA metrics
  track_dora_metrics: true
  metrics_file: "{project-root}/docs/metrics/dora.yaml"

# Monitoring Configuration
monitoring:
  platform: "auto"                           # Auto-detect or specify: prometheus, datadog, newrelic, cloudwatch
  setup_on_first_deploy: true                # Auto-setup monitoring on first deployment to environment

  # Alert channels
  alert_channels:
    # - type: "slack"
    #   webhook_url_env: "SLACK_WEBHOOK_URL"
    # - type: "email"
    #   recipients: ["team@example.com"]

  # Health checks
  health_check_endpoint: "/health"
  health_check_interval: "30s"

  # Synthetic monitoring
  uptime_checks: false                       # Setup uptime monitoring (optional)

# Performance Configuration
performance:
  # Profiling
  profiling_tool: "auto"                     # Auto-detect or specify: clinic, 0x, lighthouse
  profile_on_staging: true                   # Auto-profile staging deployments

  # Load testing
  load_testing_tool: "k6"                    # k6, artillery, jmeter
  load_test_scenarios: "{project-root}/tests/load/"

  # Default SLAs (if not specified in story)
  default_slas:
    api_response_time_p95_ms: 500            # API response time 95th percentile in milliseconds
    page_load_time_ms: 3000                  # Page load time in milliseconds
    error_rate: 0.01                         # Error rate (1%)

# Paths
deployment_logs: "{project-root}/logs/deployments"
infrastructure_state: "{project-root}/infrastructure/.tfstate"
runbooks: "{project-root}/bmad/bmi/data/runbooks"

# Integration with BMM
bmm_integration:
  extend_orchestrate_story: true             # Extend orchestrate-story with deployment steps
  extend_orchestrate_epic: true              # Extend orchestrate-epic with release steps
  integration_hooks_path: "{project-root}/bmad/bmi/integration"
